/** 
* @file reportheight.c 
* @version 1.0
* @since 2013-03-25
* @author Jimmy Lin (u5223173) - u5223173@uds.anu.edu.au
*
* Edited by MacVim
* Info auto-generated by Snippet 
* */

#include <stdio.h>
#include <stdlib.h>

#define SIZE_OF_STRING 100

struct person {
    char name [SIZE_OF_STRING];
    float height;
};

int main () 
{
    FILE * data;

    int numOfPeople = 0;
    float maxHeight = -1;
    float minHeight = SIZE_OF_STRING;
    float sumHeight = 0;
    char * highestPerson = (char *) malloc (SIZE_OF_STRING);
    char * shortestPerson = (char *) malloc (SIZE_OF_STRING);

    data = fopen("./data.txt", "r");
    if (data == NULL) {
        printf("data file not found ...\n");
        return -1;
    }

    char * str = (char *) malloc (SIZE_OF_STRING);
    float * hp = (float *) malloc (sizeof(float));
    char * nameChar ;
    char * heightChar ;
    while ( fgets(str, SIZE_OF_STRING , data) != NULL ) {
        int i;
        int lastCommaIndex = 0;
        int numOfComma = 0;
        nameChar = (char *) malloc (SIZE_OF_STRING);
        heightChar = (char *) malloc (SIZE_OF_STRING);

        for (i = 0 ; i < SIZE_OF_STRING; i++){
            if (*(str + i) == ',') {
                numOfComma ++;
                *(nameChar + i) = '\00';
                lastCommaIndex = i + 1;
            } else if ( *(str + i) == '\n') {
                *(heightChar - lastCommaIndex + i) = '\00';
                break;
            }
            if (numOfComma == 0 ) {
                *(nameChar + i) = *(str + i);
            } else if (numOfComma == 1 ) {
                *(heightChar + i - lastCommaIndex) = *(str + i);
            }
        } 

        *hp = atof(heightChar);
        if (*hp < minHeight) {
            minHeight = *hp;
            shortestPerson = nameChar;
        } else if (*hp > maxHeight) {
            maxHeight = *hp;
            highestPerson = nameChar;
        }

        numOfPeople ++;
        sumHeight += *hp;
    }
    fclose(data);
    float averageHeight = sumHeight / numOfPeople;
    printf("Of the %d people the average height is %.1fm, the tallest person is %s at %.1fm, and shortest is %s at %.1fm.\n",
            numOfPeople, averageHeight, highestPerson, maxHeight, shortestPerson, minHeight);

    return 0;
}
