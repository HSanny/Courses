<html> 
  <head> 
    <title>Planning</title> 
    <link rel=stylesheet 
     href="http://www.cs.utexas.edu/users/nn/nn.css"
     type="text/css">  
  </head> 
  <body> 
  <h1>Planning<br> 
        (due 11:59 pm, Tuesday, Oct 8, 2012)</h1> 
 
<P> 

In this exercise, you will implement an extension to the STRIPS planner in OpenNERO. See <a href="http://code.google.com/p/opennero/wiki/SymbolicPlanning">Symbolic Planning demo</a>.

<H2>The OpenNERO Platform</H2> 
<I>(The software has been updated since HW1, so you will need to re-install OpenNERO)</I>
<p>The following steps should help get you up and running in OpenNERO:


<ol>
  <li>Install it on your own machine (or in <a href="http://www.cs.utexas.edu/facilities/public-labs">one of the public labs</a>) by downloading one of the <a href="http://code.google.com/p/opennero/downloads/list">prebuilt binaries</a></li>
  <li><a href="http://code.google.com/p/opennero/wiki/BuildingOpenNero">Build OpenNERO</a> on your own machine using the source code.</li>
</ol>

<h2>Running the Goal-Stack(STRIPS) Agents</h2>

a) To run the planners with the 3D animations:

<ol>
Launch the OpenNERO GUI -> select "BlocksTower" -> Press "Start" -> Select a planner -> Press "Start"
</ol>
You can ignore the "Semantic Parser" planner for now, this is for a future assignment.  For this assignment you will be concerned with the "Goal Stack" planners, though you should take a look at the first two options as well (Problem Reduction, State Space Search).  Look at the  <a href="http://code.google.com/p/opennero/wiki/SymbolicPlanning">OpenNERO</a> website to understand how to interpret the output of the planners.  
<p><I> Note that the 3 block planner gets stuck in an infinite loop, you will be fixing this as your assignment.</I>  

<p>b) To run the strips planner from the command line directly (without the 3D gui), execute the following command for running 2 disk case:

<ol>
python strips.py towers2_strips.txt
</ol>

Execute the following command for running 3 disk case:

<ol>
python strips.py towers3_strips.txt
</ol>



<h2>Problem Statement</h2>
In this assignment, we will be solving a famous planning problem called the Towers of Hanoi. 
We will be extending the STRIPS planner (also called Goal-Stack planner) to solve this. First,
to get an intuition for the problem, run OpenNERO and select the BlocksTower mod (instead of Maze), as described above. 

<h2>Extending STRIPS Planner</h2>

The STRIPS planner in its current implementation 
fails to solve the 3-disk problem. STRIPS is linear, i.e. it adds actions to the plan in
a linear order as soon as they are found. In many cases there are
interactions between the actions such that a later action clobbers a
goal that was already achieved earlier. Goal reintroduction allows
fixing such a "clobbered" goal again, which makes it possible to solve
e.g. the 2-disk problem. However, the planner still fails in the
3-disk case, by getting into an infinite loop of clobbering goals and
reintroducting them.

Your assignment is to find a solution to this problem. 
<ol>
        <li> As a first step to solve this assignment, go through the planning steps printed in output window
for the STRIPS planner. Notice, how it solves the 2-disk problem. Now, think about how STRIPS will solve
a 3 disk problem and figure out why it ends up into infinite loop. To run STRIPS code for the 3 disk problem, modify queue_init() function of TowerAgent3, replacing towers2_strips.txt with towers3_strips.txt.  </li>

<li> Once you have understood this infinite loop problem, modify the current code to detect it.</li> 
<li> Write an extension to STRIPS solver which fixes this infinite loop problem (there might be more than one solution to this).</li>
<li> Now analyze your implementation for the above fix and see whether its a general solution. What are the scenarios
under which this implementation can fail (say in a 4 disk problem etc.)? </li>
</ol>

Explain your solutions for all the parts in the report.


<h3>Hints</h3>
To fix the STRIPS hang problem in 3 disk case, first understand the function linear_solver_helper () in strips.py. See why it sorts the possible actions before picking one of them. Now based on your understanding of the 3 disk hang situation, can you modify the rule for sorting the possible actions to fix the problem.

There could be more than one solution to the 3 disk hang problem. I have hinted the one that worked for me. Other methods could involve keeping a history of state-action pairs and using them to select the next action from the possible actions. If you can find a different approach which is neater than the one I described above, you will be eligible for extra credits.

In your report, also explain possible scenarios where your suggested fix can fail. It should at least work for 2 and 3 disk cases though.


<h3>File modifications</h3>
Create a new class called MyPlanningAgent by copying the existing STRIPS planner (TowerAgent4) in the <tt>BlocksTower/angent.py</tt> file. The other relevant files that the existing STRIPS planner calls are - strips.py and towers2_strips.txt located in the same folder.

<p>Once you've created your agent, you'll need to add it to the configuration file for the OpenNERO BlocksTower mod. To do this, locate the SydneyAStar.xml file (<tt>BlocksTower/data/shapes/character/BlocksRobot4.xml</tt>) and change the following line:

<pre>
 &lt;Python agent=&quot;BlocksTower.agent.TowerAgent4()&quot; /&gt;
</pre>

to:
<pre>
 &lt;Python agent=&quot;BlocksTower.agent.MyPlanningAgent()&quot; /&gt;
</pre>

Once you've configured this line, pressing the <tt>Goal Stack - 3 Block</tt> button in the BlocksTower mod will run your planner.

You may run your agent with or without the 3D graphics for testing purposes.  The GUI visualization is just a add-on for clarity and does not effect your grades.

<h2>Debugging</h2>
If you run into any bugs in your program, you can find the error log file for OpenNERO at one of the following locations:

<ul>
<li><b>Linux or Mac:</b> <tt>~/.opennero/nero_log.txt</tt></li>
<li><b>Windows:</b> <tt>"AppData\Local\OpenNERO\nero_log.txt"</tt> or <tt>"Local Settings\Application Data\OpenNERO\nero_log.txt"</tt> depending on the version of Windows you have.</li>
</ul>

<H2>Turning in your work</H2>
Turn your your agent.py file, any additional <tt>*.py</tt> files that you created and a summary report electronically using <A HREF="http://www.cs.utexas.edu/users/risto/cs343/turnin.html"><TT>turnin</TT></A> (grader: <tt>houck</tt>, homework: <tt>cs343-hw2</tt>). In your report, include any instructions needed to run your agent, as well as a brief description of how you solved the problem, including possible scenarios where your suggested fix can fail (it should work for 2 and 3 blocks at least).  As mentioned before, it may be easiest to just "tar" the directory and submit the tar-file to <TT>turnin</TT>.
 
</body> 
</html> 
