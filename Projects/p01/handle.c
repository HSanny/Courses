/**##############################################################
## MODULE: handle.c
## VERSION: 1.2 
## SINCE: 2013-09-11
## AUTHOR: Jimmy Lin (xl5224) - JimmyLin@utexas.edu  
## DESCRIPTION: 
##    Usage of sinal handler and nanosleep in the process control.
##
#################################################################
## Edited by MacVim
## Class Info auto-generated by Snippet 
################################################################*/
#include <assert.h>
#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <signal.h>
#include <time.h>
#include <unistd.h>
#include "util.h"


#define true 1

void SIGINT_Handler (int sig) {
    // safe printing codes from the project requirement
    ssize_t bytes; 
    const int STDOUT = 1; 
    bytes = write(STDOUT, "Nice try.\n", 10); 
    if(bytes != 10) 
        exit(-999);
}

void SIGUSR1_Handler (int sig) {
    // safe printing codes from the project requirement
    ssize_t bytes; 
    const int STDOUT = 1; 
    bytes = write(STDOUT, "Exiting.\n", 9); // exiting output
    if(bytes != 9) 
        exit(-999);
    else
        exit(1); // exit status
}

/*
 * First, print out the process ID of this process.
 *
 * Then, set up the signal handler so that ^C causes
 * the program to print "Nice try.\n" and continue looping.
 *
 * Finally, loop forever, printing "Still here\n" once every
 * second.
 */
int main(int argc, char **argv)
{
    // installment of SIGINT signal handler
    Signal(SIGINT, SIGINT_Handler);
    // installment of SIGUSR1 signal handler
    Signal(SIGUSR1, SIGUSR1_Handler);

    // obtain current process number
    pid_t mypid = getpid();

    // print the current process id
    printf("pid is: %d\n", mypid);

    while (true) {
        // initialize the structure that specifies sleep information
        struct timespec req;
        req.tv_sec = 1;
        req.tv_nsec = 0;
        printf("Still here\n");
        // if interrupted, save the remained sleep time and 
        //     continue the remained sleep then.
        // else finish the specified 1-second sleep
        while (nanosleep(&req, &req) == -1) {
            continue;
        }
    }

    return 0;
}
